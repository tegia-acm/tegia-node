#include <string>
#include <regex>

#include <tegia2/core/contacts/vk.h>
#include <tegia2/core/cast.h>



namespace tegia {
namespace contacts {


///////////////////////////////////////////////////////////////////////////////////////////
/*

*/
///////////////////////////////////////////////////////////////////////////////////////////


vk_t::vk_t():contact_t("vk")
{
	
};



///////////////////////////////////////////////////////////////////////////////////////////
/*

*/
///////////////////////////////////////////////////////////////////////////////////////////

std::string vk_t::value() const
{
	return core::cast<std::string>(this->_id);
};


///////////////////////////////////////////////////////////////////////////////////////////
/*

*/
///////////////////////////////////////////////////////////////////////////////////////////


bool vk_t::set_link(const std::string &link)
{
	if(link == "")
	{
		this->_id = 0;
		this->_is_valid = false;
		return false;		
	}

	//
	// Проверяем,что это прямая ссылка на ID
	//

	// this->_link = link;
	std::regex  _regex(R"(id[0-9]{1,})");
	std::smatch _match;
	if(std::regex_search(link, _match, _regex))
	{
		this->_link = link;
		this->_id = core::cast<long long int>(_match[0].str().substr(2));
		this->_is_valid = true;
		return true;
	}
	else
	{
		this->_link = "";
		this->_id = 0;
		
		std::cout << _ERR_TEXT_ <<  std::endl;
		std::cout << this->_link << std::endl;
		std::cout << "not found pattern '" << R"(id([0-9]+)$)" << "'" << std::endl;
		this->_is_valid = false;
		return false;
	}
};


///////////////////////////////////////////////////////////////////////////////////////////
/*

*/
///////////////////////////////////////////////////////////////////////////////////////////


bool vk_t::set_id(long long int id)
{
	if(id > 0)
	{
		this->_id = id;
		this->_is_valid = true;
		return true;
	}
	else
	{
		this->_id = 0;
		this->_is_valid = false;
		return false;
	}
};

///////////////////////////////////////////////////////////////////////////////////////////
/*

*/
///////////////////////////////////////////////////////////////////////////////////////////




}	// END namespace contacts
}	// END namespace tegia